angular.module("theos",[]).controller("theosCtrl",["$scope","$http",function(n,r){n.profissoes=[],n.cidades_estados=[],n.loading=!0,n.modalTitle="",n.lista_profissoes=[{cod:1,nome:"Administrador"},{cod:2,nome:"Bioquímico"},{cod:3,nome:"Chaveiro"},{cod:4,nome:"Dentista"},{cod:5,nome:"Economista"},{cod:6,nome:"Farmacêutico"},{cod:7,nome:"Geólogo"},{cod:8,nome:"Ilustrador"},{cod:9,nome:"Nutricionista"},{cod:10,nome:"Programador"}],n.profissional={_id:0,nome:"",sobrenome:"",email:"",sexo:"Masculino",estado:"",cidade:"",area_formacao:""},modal=document.getElementById("modal_cadastro"),api="http://localhost:3000/api/profissao",n.search=function(o){return null==n.pesquisa||(-1!=o.nome.toLowerCase().indexOf(n.pesquisa.toLowerCase())||-1!=o.sobrenome.toLowerCase().indexOf(n.pesquisa.toLowerCase())||-1!=o.profissao.toLowerCase().indexOf(n.pesquisa.toLowerCase()))},r({method:"GET",url:"http://localhost:3000/assets/json/cidadesestados.json"}).then(function(o){n.cidades_estados=o.data,n.profissional.estado=n.cidades_estados[0],n.profissional.cidade=n.profissional.estado.cidades[0]},function(o){console.log(o)}),n.setCidadeFirst=function(){n.profissional.cidade=n.profissional.estado.cidades[0]},n.requisicao=function(o,i,s){console.log(o,i,s),n.loading=!0;var e=null!=o&&null!=o||null!=s&&null!=s?o:"GET",a={method:e,url:null==i||null==i?api:api+"/"+i,data:s,headers:{"Content-Type":"application/json"}};r(a).then(function(o){if(n.loading=!1,"success"==o.data.message)switch(e){case"DELETE":n.profissoes=n.profissoes.filter(function(o){return o._id!=i});break;case"POST":var s=n.profissoes;s.push(o.data.data),n.profissoes=s;break;case"PUT":var a=n.profissoes.findIndex(function(o){return o._id==i});n.profissoes[a].area_formacao=o.data.data.area_formacao,n.profissoes[a].cidade=o.data.data.cidade,n.profissoes[a].email=o.data.data.email,n.profissoes[a].estado=o.data.data.estado,n.profissoes[a].nome=o.data.data.nome,n.profissoes[a].profissao=o.data.data.profissao,n.profissoes[a].sexo=o.data.data.sexo,n.profissoes[a].sobrenome=o.data.data.sobrenome;break;default:n.profissoes=o.data.data}},function(o){console.log(o)})},n.salvarProfissional=function(){n.loading=!0,n.profissional.profissao=n.profissional.profissao.nome,n.profissional.estado=n.profissional.estado.sigla;var o=angular.copy(n.profissional);0==n.profissional._id?(delete o._id,n.requisicao("POST",null,o)):n.requisicao("PUT",n.profissional._id,o),n.closeModal()},n.editar=function(s){n.modalTitle="Editar cadastro",modal.classList.remove("fechar"),modal.classList.add("abrir");var a=n.profissoes.filter(function(o){return o._id==s}),o=n.cidades_estados.findIndex(function(o){return o.sigla==a[0].estado}),i=n.cidades_estados[o].cidades.findIndex(function(o){return o==a[0].cidade}),e=n.lista_profissoes.findIndex(function(o){return o.nome==a[0].profissao});n.profissional._id=a[0]._id,n.profissional.nome=a[0].nome,n.profissional.sobrenome=a[0].sobrenome,n.profissional.email=a[0].email,n.profissional.sexo=a[0].sexo,n.profissional.estado=n.cidades_estados[o],n.profissional.cidade=n.profissional.estado.cidades[i],n.profissional.area_formacao=a[0].area_formacao,n.profissional.profissao=n.lista_profissoes[e]},n.novoCadastro=function(){n.modalTitle="Novo profissional",n.profissional._id=0,modal.classList.remove("fechar"),modal.classList.add("abrir")},n.closeModal=function(){modal.classList.remove("abrir"),modal.classList.add("fechar"),n.profissional._id=0,n.profissional.nome="",n.profissional.sobrenome="",n.profissional.email="",n.profissional.sexo="Masculino",n.profissional.estado=n.cidades_estados[0],n.profissional.cidade=n.profissional.estado.cidades[0],n.profissional.area_formacao="",delete n.profissional.profissao},n.requisicao()}]).directive("loading",function(){return{restrict:"E",replace:!0,template:'<p class="loading"><img src="../assets/img/loading.gif"/></p>',link:function(o,s,a){o.$watch("loading",function(o){o=o?$(s).show():$(s).hide()})}}}).filter("formatarData",function(){return function(o){var s=new Date(o),a=s.getHours()<10?"0"+s.getHours():s.getHours(),i=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes();return new Date(o).toLocaleDateString()+" - "+a+":"+i}});